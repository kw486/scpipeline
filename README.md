
# Single Cell Analyis Pipeline

Collection of scripts used to investigate interactions between transcriptional regulators in *S. cerevisiae* using single cell RNA-Seq data. The data was originally generated by [Jackson et al. (2019)](https://www.biorxiv.org/content/10.1101/581678v1.full). Their study constructed a gene regulatory network (GRN) comprising 496 interactions based on sequences from 38,285 individual cells. The focus is specifically on nitrogen metabolism and related stress response pathways. 

To extend their analysis and further investigate the interactions between these transcriptional regulators we reconstruct multiple models of the underlying cellular network using Nested Effect Models (NEMs), an approach that uses gene expression profiles as indicators of downstream effects to establish how the action of each individual perturbation is related.

## Set Up & Packages
Data from the Jackson et al. 11  single cell perturbation experiments is downloaded from [SCperturb](https://github.com/markowetzlab/SCperturb) package as a standardized sparse counts matrix.

```
> install.packages(devtools)
> devtools::install_github("markowetzlab/SCperturb")
> library(SCperturb)
```

Data is loaded as a [SingleCellExperiment](http://bioconductor.org/packages/release/bioc/html/SingleCellExperiment.html) object which is designed for use with single cell data.

To install this package, start R (version "4.0") and enter:
```
>  if (!requireNamespace("BiocManager", quietly = TRUE))
>      install.packages("BiocManager")
>  BiocManager::install("SingleCellExperiment")
```
## Data Structure
SingleCellExperiment contains the counts matrix with columns describing single cells and the rows describing the genes. 

The SingleCellExperiment data structure also holds metadata information:

* Row metadata \- the chromosomal location of the gene and the corresponding Ensembl gene symbol where available

* Column metadata \- the perturbed gene name, the cell barcode to uniquely identify the cell (unique molecular identifier, UMI) and the guide RNA used in the gene deletion process

Data is split into 11 named categories which relate to the growth conditions for those cells.
("CSTARVE", "NLIMUREA", "NLIMNH4", "NLIMPRO", "NLIMGLN", "MMETOH", "MMD", "YPETOH", "RAPA", "DIAUXY", "YPD").


### 02_DiffExpression_EGeneSelection_RunNEMS
* Note that QC pipeline was deemed redundant - confirmed with original authors (cell counts too low for mitochondrial screening). 
* Follows a [Seurat](https://satijalab.org/seurat/) pipeline designed to utilise and integrate information across different datasets.
* Collapse the data from the six independently constructed biological replicates for each genotype into pseudobulk data for each genotype/condition combination to ensure cell counts exceeded the lower limit on cell number imposed by Seurat. 
* Conduct a differential expression analysis between the control (WT) and each perturbed gene in that condition, filter by log fold change and adjusted p-value and finally binarise the output, resulting in a n x m matrix of 11 columns (perturbations) and m rows (significant differentially expressed genes).

In order to distinguish genes with significant differences in expression between WT and perturbation strains, we filter differentially expressed genes by adjusted p-value (0.05) and log fold change, reflecting the parameters used by Jackson et al. We also generate a discretized binary matrix required for downstream modelling of the NEMs.

To reconstruct the Nested Effect Models we use the [NEMpipeline](https://github.com/bitmask/NEMpipeline) package. Then to test robustness we conduct a bootstrap for each network, which resamples 80% of the E-genes used and reruns the network inference on this new E-gene subset. 
